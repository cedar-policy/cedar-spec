.PHONY: all run test

all:
	cd ../cedar-lean && lake build Cedar:static DiffTest:static Std:static Mathlib:static Qq:static Aesop:static ProofWidgets:static
	LEAN_LIB_DIR=`lean --print-libdir` \
	cargo build;
	LEAN_LIB_DIR=`lean --print-libdir` \
	cd fuzz && LEAN_LIB_DIR=`lean --print-libdir` cargo build

test: all
	DYLD_LIBRARY_PATH=`lean --print-libdir`:${DYLD_LIBRARY_PATH} \
	LD_LIBRARY_PATH=`lean --print-libdir`:${LD_LIBRARY_PATH} \
	LEAN_LIB_DIR=`lean --print-libdir` \
	cargo test

run: all
	DYLD_LIBRARY_PATH=`lean --print-libdir`:${DYLD_LIBRARY_PATH} \
	LD_LIBRARY_PATH=`lean --print-libdir`:${LD_LIBRARY_PATH} \
	LEAN_LIB_DIR=`lean --print-libdir` \
	cargo fuzz run -s none $(target)